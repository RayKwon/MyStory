@model IEnumerable<MyStory.ViewModels.PostListViewModel>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Style{
    <link href="@Url.Content("~/Content/Prettify/Themes/sons-of-obsidian.css")" rel="stylesheet" type="text/css" />
}
@if (ViewBag.NumberOfAccounts == 0)
{
    <div class="hero-unit">
        <h2>
            No Account and Blog created yet.</h2>
        <p>
            To create account and blog</p>
        <p>
            <a href="@Url.Action("Register", "Account")" class="btn btn-primary btn-large"><i
                class="icon-ok icon-white"></i>Click Here</a></p>
    </div>
}
else
{
    if (Model.Count() == 0)
    {
    <div class="alert alert-info">
        <p>
            There is no post yet.</p>
        <p>
            <a href="@Url.Action("Write", "Post")" class="btn btn-primary btn-small">Create Post</a></p>
    </div>
    }
}
@* view using Masonry *@
<div id="masonry-container">
    @if (Model != null)
    {
        foreach (var item in Model)
        {
        <div class="masonrybox shadow" style="padding:5px" id="@item.Id">
            <h3>
                @Html.ActionLink(item.TitleShort, "Detail", "Post", new { Id = item.Id }, new { @class = "article-title", title = item.Title, name=item.Id })</h3>
            <p>
                @Html.Raw(item.Content)</p>
            @if (Request.IsAuthenticated)
            {
                <p>
                    @Html.ActionLink("edit", "Edit", "Post", new { id = item.Id }, null) | <a  class="delete-post-link" data-toggle="modal" href="#modal-delete-post" onclick="openModal('@item.Id');" >
                        delete</a>
                </p>
            }
        </div>
        }
    }
</div>
@*Modal popup for delete post*@
@Html.Partial("DeletePostPopup")
@* view using Bootstrap Thumbnail *@ @*<ul class="thumbnails">
    @if (Model != null)
    {
        foreach (var item in Model)
        {
        <li class="span3">            
            <div class="thumbnail shadow">
            <h3>
                @Html.ActionLink(item.Title, "Detail", "Post", new { Id = item.Id }, new { @class = "article-title" })</h3>
            <p>
                @Html.Raw(item.Content)
            </p>
            @if (Request.IsAuthenticated)
            {
                <p>
                    @Html.ActionLink("edit", "Edit", "Post", new { id = item.Id }, null) | <a  class="delete-post-link" data-toggle="modal" href="#modal-delete-post" onclick="openModal('@item.Id');" >
                        delete</a>
                </p>
            }
            </div>
        </li>
        }
    }
</ul>*@

<nav id="page-nav">
  <a href="/home/index?page=2"></a>
</nav>
@section Script{
    <script src="@Url.Content("~/Scripts/jquery.masonry.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.infinitescroll.min.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $('#home-nav').addClass('active');

            $('pre').addClass('prettyprint linenums');
            prettyPrint();

            // remove container box 
            $('#main-body').removeClass('well');
            $('#main-body').removeClass('shadow');

            $('.article-title').tooltip({
                placement: 'top',
                delay: { show: 200, hide: 100 },
            });

            var $container = $('#masonry-container');

            $container.masonry({
                itemSelector: '.masonrybox',
                isAnimated: true
            });

            $container.infinitescroll({
              navSelector  : '#page-nav',    // selector for the paged navigation 
              nextSelector : '#page-nav a',  // selector for the NEXT link (to page 2)
              itemSelector : '.masonrybox',     // selector for all items you'll retrieve
              loadingText : 'Loading new posts...',
              },
              // trigger Masonry as a callback
              function( newElements ) {
                // hide new items while they are loading
                var $newElems = $( newElements ).css({ opacity: 0 });
                // ensure that images load before adding to masonry layout
                $newElems.imagesLoaded(function(){
                  // show elems now they're ready
                  $newElems.animate({ opacity: 1 });
                  $container.masonry( 'appended', $newElems, true ); 
                });
              }
            );

            $('#delete-confirm').click(function () {
                $.ajax({
                    cache: false,
                    type: "POST",
                    async: false,
                    url: "/Post/Delete/" + selectedPostIdToDelete,
                    contentType: "application/json",
                    dataType: "json",
                    success: function (result) {
                        $('#modal-delete-post').modal('hide');  // hide modal
                        $('div#' + selectedPostIdToDelete).remove();            // remove the deleted article
                        $('#masonry-container').masonry(); //.reload(); // reload masonry layout
                    },
                    error: function (request, status, error) {
                        alert(error);
                    }
                });
            });
        });

        var selectedPostIdToDelete;

        function openModal(postId) {
            this.selectedPostIdToDelete = postId;
        }
    </script>
}
